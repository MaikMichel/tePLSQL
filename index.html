<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>tePLSQL by osalvador</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">tePLSQL</h1>
      <h2 class="project-tagline">PLSQL Template engine </h2>
      <a href="https://github.com/osalvador/tePLSQL" class="btn">View on GitHub</a>
      <a href="https://github.com/osalvador/tePLSQL/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/osalvador/tePLSQL/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="teplsql" class="anchor" href="#teplsql" aria-hidden="true"><span class="octicon octicon-link"></span></a>tePLSQL</h1>

<p>Template Engine for PLSQL.</p>

<p>tePLSQL is a template engine written completly in PL/SQL, generate text output (HTML web pages, e-mails, configuration files, source code, etc.) based on templates. Templates are written with embebed Dynamic PL/SQL . </p>

<p>With tePLSQL you should prepare the data to display in your PL/SQL packages and do business calculations, and then the template displays that already prepared data. In the template you are focusing on how to present the data, and outside the template you are focusing on what data to present.</p>

<p>Now tePLSQL has the same syntax as the old fashion <a href="http://docs.oracle.com/cd/E11882_01/appdev.112/e41502/adfns_psp.htm#ADFNS016">Oracle PSP</a> so you do not have to learn any new template language and your PSP will be supported by tePLSQL making some small modifications.</p>

<p>Templates are processed and a single block of PL/SQL code being executed dynamically, as does the Oracle PSP loader do.  </p>

<p>For a quick look see <a href="#basic-example">basic example</a>. The best example of use tePLSQL is <a href="https://github.com/osalvador/tapiGen2">tapiGen2</a></p>

<p><strong>topics</strong>:</p>

<ul>
<li>
<a href="#prerequisites">Prerequisites for developing and deploying tePLSQL templates</a>

<ul>
<li><a href="#install">Install</a></li>
<li><a href="#compatibility">Compatibility</a></li>
</ul>
</li>
<li>
<a href="#developing">Developing tePLSQL templates</a>

<ul>
<li><a href="#teElements">tePLSQL elements</a></li>
<li><a href="#characteristics">Specifying tePLSQL template characteristics</a></li>
<li><a href="#arguments">tePLSQL arguments</a></li>
<li><a href="#naming">Naming the tePLSQL templates</a></li>
<li><a href="#include">Including the contents of other template</a></li>
<li><a href="#declare">Declaring global variables in a tePLSQL template</a></li>
<li><a href="#executable">Specifying executable statements in a tePLSQL template</a></li>
<li><a href="#expression">Substituting expression values in a tePLSQL template</a></li>
<li><a href="#escape">Escaping reserved words in a tePLSQL template</a></li>
<li><a href="#lineBreak">Print line break to the output</a></li>
<li>
<a href="#noLineBreak">Remove line break from the output</a><br>
</li>
</ul>
</li>
<li><a href="#load">Loading and storing tePLSQL templates into the Database</a></li>
<li><a href="#examples">Examples of tePLSQL templates</a></li>
<li><a href="#debug">Debugging tePLSQL templates</a></li>
<li><a href="#apiReference">tePLSQL API reference</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>

<p><a name="prerequisites"></a></p>

<h2>
<a id="prerequisites-for-developing-and-deploying-teplsql-templates" class="anchor" href="#prerequisites-for-developing-and-deploying-teplsql-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prerequisites for developing and deploying tePLSQL templates</h2>

<p>To develop and deploy tePLSQL templates, you must meet these prerequisites:</p>

<ul>
<li>To write a tePLSQL templates you need a text editor. No other development tool is required.</li>
<li>To load a tePLSQL template you need an account on the database in which to load the templates.<br>
</li>
<li>To deploy tePLSQL template you must install tePLSQL package. </li>
</ul>

<p><a name="install"></a></p>

<h3>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h3>

<p>Download and compile <code>TE_TEMPLATES.sql</code>,<code>TEPLSQL.pks</code> and <code>TEPLSQL.pkb</code>. No schema grants are necesary.</p>

<p><a name="compatibility"></a></p>

<h3>
<a id="compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compatibility</h3>

<p>tePLSQL use regular expressions to process templates. Regular expressions were added in Oracle version 10 therefore teplsql works in Oracle Database 10g, 11g and 12c (all editions including XE).</p>

<p><a name="developing"></a></p>

<h2>
<a id="developing-teplsql-templates" class="anchor" href="#developing-teplsql-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developing tePLSQL templates</h2>

<p>The order and placement of the tePLSQL directives and declarations is usually not significant. It becomes significant only when another template is included. For ease of maintenance, we recommends that you put the directives and declarations near the beginning of the template.</p>

<p>The next table lists the tePLSQL elements and directs you to the section that explains how to use them. </p>

<p><a name="teElements"></a></p>

<h3>
<a id="teplsql-elements" class="anchor" href="#teplsql-elements" aria-hidden="true"><span class="octicon octicon-link"></span></a>tePLSQL elements</h3>

<table>
<thead>
<tr>
<th>Element</th>
<th>Name</th>
<th>Description</th>
<th>Section</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;%@ template key=value,key=value %&gt;</code></td>
<td>Template Directive</td>
<td>Characteristics of the template</td>
<td><a href="#characteristics">Specifying tePLSQL template characteristics</a></td>
</tr>
<tr>
<td><code>${varName}</code></td>
<td>Arguments</td>
<td>The arguments are defined in a key-value associative array that receives as parameter by the render</td>
<td><a href="#arguments">tePLSQL arguments</a></td>
</tr>
<tr>
<td><code>&lt;%@ include(...) %&gt;</code></td>
<td>Include Directive</td>
<td>Includes and evaluates the specified template</td>
<td><a href="#include">Including the contents of other template</a></td>
</tr>
<tr>
<td><code>&lt;%! ... %&gt;</code></td>
<td>Declaration block</td>
<td>The declaration for a set of PL/SQL variables that are visible throughout the template, not just within the next BEGIN/END block.</td>
<td><a href="#declare">Declaring global variables in a tePLSQL template</a></td>
</tr>
<tr>
<td><code>&lt;% ... %&gt;</code></td>
<td>Code block</td>
<td>A set of PL/SQL statements to be executed when the template is run.</td>
<td><a href="#executable">Specifying executable statements in a tePLSQL template</a></td>
</tr>
<tr>
<td><code>&lt;%= ... %&gt;</code></td>
<td>Expression block</td>
<td>A single PL/SQL expression</td>
<td><a href="#expression">Substituting expression values in a tePLSQL template</a></td>
</tr>
<tr>
<td><code>\\</code></td>
<td>Escaped character</td>
<td>Escaping reserved words like <code>&lt;% .. %&gt;</code> and <code>q'[]'</code>
</td>
<td><a href="#escape">Escaping reserved words strings in a tePLSQL template</a></td>
</tr>
<tr>
<td><code>\\n</code></td>
<td>Line Break</td>
<td>Print line break to the output</td>
<td><a href="#lineBreak">Print line break to the output</a></td>
</tr>
<tr>
<td><code>!\n</code></td>
<td>Remove line break</td>
<td>Remove line break from the output</td>
<td><a href="#noLineBreak">Remove line break from the output</a></td>
</tr>
</tbody>
</table>

<p><a name="characteristics"></a></p>

<h3>
<a id="specifying-teplsql-template-characteristics" class="anchor" href="#specifying-teplsql-template-characteristics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Specifying tePLSQL template characteristics</h3>

<p>Use the <code>&lt;%@ template ... %&gt;</code> directive to specify characteristics of the template:</p>

<ul>
<li>What is the name of the template, mandatory.</li>
<li>Any other user-defined feature like version, date, author...</li>
</ul>

<p>The characteristics are a pair of key-value separated by commas. </p>

<p>Values defined in  <code>&lt;%@ template ... %&gt;</code> directive can be accessed anywhere in the template  as a variable argument, preceding the name of the key with the <code>template</code>.</p>

<h4>
<a id="syntax" class="anchor" href="#syntax" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<p><code>&lt;%@ template key=value, key2=value2 %&gt;</code></p>

<p>The syntax is case-sensitive but space-insensitive. Values with blanks are not allowed.</p>

<h4>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<pre><code>&lt;%@ template name=example_template, version=0.1 %&gt;
Processing template ${template_name} with version ${template_version}
</code></pre>

<p>Output:</p>

<pre><code>Processing template example_template with version 0.1
</code></pre>

<p><a name="arguments"></a></p>

<h3>
<a id="teplsql-arguments" class="anchor" href="#teplsql-arguments" aria-hidden="true"><span class="octicon octicon-link"></span></a>tePLSQL arguments</h3>

<p>The arguments variable are defined in Oracle PL/SQL associative array that receives as parameter by the render. Within the templates reference to ahce variables via <code>${varName}</code>.</p>

<h4>
<a id="syntax-1" class="anchor" href="#syntax-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">DECLARE</span>   
   p_vars       teplsql.t_assoc_array;
<span class="pl-k">BEGIN</span>   
   p_vars (<span class="pl-s">'FullName'</span>) <span class="pl-k">:=</span> <span class="pl-s">'Oscar Salvador Magallanes'</span>;
<span class="pl-k">END</span>;</pre></div>

<h4>
<a id="example-1" class="anchor" href="#example-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">DECLARE</span>
   p_template   <span class="pl-k">VARCHAR2</span> (<span class="pl-c1">32000</span>);
   p_vars       teplsql.t_assoc_array;
<span class="pl-k">BEGIN</span>
   p_template  <span class="pl-k">:=</span><span class="pl-s">'Hi ${FullName}!'</span>;

   p_vars (<span class="pl-s">'FullName'</span>) <span class="pl-k">:=</span> <span class="pl-s">'Oscar Salvador Magallanes'</span>;
   p_template  <span class="pl-k">:=</span> teplsql.render (p_vars, p_template);
   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (p_template);
<span class="pl-k">END</span>;</pre></div>

<p>Output:</p>

<pre><code>Hi Oscar Salvador Magallanes
</code></pre>

<p><a name="naming"></a></p>

<h3>
<a id="naming-the-teplsql-templates" class="anchor" href="#naming-the-teplsql-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Naming the tePLSQL templates</h3>

<p>In order to access and store templates correctly you must specify the template name in the <code>&lt;%@ template ... %&gt;</code> directive.</p>

<p>To specify a template name, use this directive, where tmpl is the name for the template:</p>

<pre><code>&lt;%@ template name=tmpl %&gt;
</code></pre>

<p>It is the name of the template, not the name of the object that you store the template. </p>

<p><a name="include"></a></p>

<h3>
<a id="including-the-contents-of-other-template" class="anchor" href="#including-the-contents-of-other-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>Including the contents of other template</h3>

<p>You can set up an include including other tePLSQL templates in the current template. Insert this directive at the point where the content of the other template is to appear, replacing template_name with the name of the template to be included. </p>

<p>Any variables available in the current template are also available within the included template. However, all variables and functions defined in the included template have the local scope.</p>

<p>Nested includes are allowed. tePLSQL search the template and include it in a new DECLARE BEGIN END; block, which assigned its own scope. </p>

<pre><code>&lt;%@ include(template1) %&gt;
    --template1 include template2
    &lt;%@ include(template2) %&gt;    
      --template3 include template3
        &lt;%@ include(template3) %&gt;    
</code></pre>

<p>Will be interpreted as:</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">DECLARE</span>
<span class="pl-k">BEGIN</span>
<span class="pl-c">--template1</span>
    <span class="pl-k">DECLARE</span>
    <span class="pl-k">BEGIN</span>  
    <span class="pl-c">--template2  </span>
        <span class="pl-k">DECLARE</span>
        <span class="pl-k">BEGIN</span>
        <span class="pl-c">--template3</span>
        <span class="pl-k">END</span>;    
    <span class="pl-k">END</span>;
<span class="pl-k">END</span>;</pre></div>

<h4>
<a id="syntax-2" class="anchor" href="#syntax-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<pre><code>   &lt;%@ include(template_name, object_name, object_type, schema) %&gt;
</code></pre>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>template_name</code></td>
<td>The name of the template. Default NULL.</td>
</tr>
<tr>
<td><code>object_name</code></td>
<td>The name of the object (usually the name of the package). Default TE_TEMPLATES table.</td>
</tr>
<tr>
<td><code>object_type</code></td>
<td>The type of the object (PACKAGE, PROCEDURE, FUNCTION...). Default PACKAGE.</td>
</tr>
<tr>
<td><code>schema</code></td>
<td>The schema of the object. Default NULL.</td>
</tr>
</tbody>
</table>

<p>You can use the include feature to pull in libraries of code into multiple templates. Alternatively, you can use this feature as a macro capability to include the same section of script code in multiple places in a template. </p>

<h4>
<a id="example-2" class="anchor" href="#example-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<p>This example includes a footer template</p>

<pre><code>&lt;%@ include (footer) %&gt;
</code></pre>

<p>This template will be search into <code>TE_TEMPLATES</code> table. </p>

<p>This is the same example, but the footer template is saved in package spec. </p>

<pre><code>&lt;%@ include(footer , tmpl_tab_api) %&gt;
</code></pre>

<p><a name="declare"></a></p>

<h3>
<a id="declaring-global-variables-in-a-teplsql-template" class="anchor" href="#declaring-global-variables-in-a-teplsql-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>Declaring global variables in a tePLSQL template</h3>

<p>You can use the <code>&lt;%! ... %&gt;</code> directive to define a set of tePLSQL variables that are visible throughout the template, not just within the next BEGIN/END block. This element typically spans multiple lines, with individual PL/SQL variable declarations ended by semicolons. </p>

<p>You can specify multiple declaration blocks; internally, they are all merged into a single block.</p>

<p>You can also use explicit DECLARE blocks within the <code>&lt;% ... %&gt;</code> delimiters that are explained in "Specifying executable statements in a tePLSQL template". These declarations are only visible to the BEGIN/END block that follows them.</p>

<p>To make things easier to maintain, keep all your directives and declarations near the beginning of a PL/SQL server template.</p>

<h4>
<a id="syntax-3" class="anchor" href="#syntax-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">&lt;</span>%! PL<span class="pl-k">/</span><span class="pl-v">SQL</span> declaration;
    [ PL<span class="pl-k">/</span><span class="pl-v">SQL</span> declaration; ] ... %<span class="pl-k">&gt;</span></pre></div>

<p>The usual PL/SQL syntax is allowed within the block. The delimiters server as shorthand, enabling you to omit the DECLARE keyword. All declarations are available to the code later in the template.</p>

<h4>
<a id="example-3" class="anchor" href="#example-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">&lt;</span>%!
  <span class="pl-k">CURSOR</span> emp_cursor <span class="pl-k">IS</span>
  <span class="pl-k">SELECT</span> last_name, first_name
  <span class="pl-k">FROM</span> hr.employees
  <span class="pl-k">ORDER BY</span> last_name;
%<span class="pl-k">&gt;</span></pre></div>

<p><a name="executable"></a></p>

<h3>
<a id="specifying-executable-statements-in-a-teplsql-template" class="anchor" href="#specifying-executable-statements-in-a-teplsql-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>Specifying executable statements in a tePLSQL template</h3>

<p>You can use the <code>&lt;% ... %&gt;</code> code block directive to run a set of PL/SQL statements when the template is run. </p>

<p>This element typically spans multiple lines, with individual PL/SQL statements ended by semicolons. The statements can include complete blocks. </p>

<p>The statements can also be the bracketing parts of IF/THEN/ELSE or BEGIN/END blocks. When a code block is split into multiple directives, you can put output text or other directives in the middle, and the middle pieces are conditionally executed when the template is run. The example provides an illustration of this technique.</p>

<p>All the usual PL/SQL syntax is allowed within the block.</p>

<h4>
<a id="syntax-4" class="anchor" href="#syntax-4" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">&lt;</span>% PL<span class="pl-k">/</span><span class="pl-v">SQL</span> statement;
   [ PL<span class="pl-k">/</span><span class="pl-v">SQL</span> statement; ] ... %<span class="pl-k">&gt;</span></pre></div>

<h4>
<a id="example-4" class="anchor" href="#example-4" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-source-plsql-oracle"><pre>  <span class="pl-k">&lt;</span>%! v_color <span class="pl-k">VARCHAR2</span>(<span class="pl-c1">20</span>); %<span class="pl-k">&gt;</span>
  <span class="pl-k">&lt;</span>% <span class="pl-k">FOR</span> ITEM <span class="pl-k">IN</span> (<span class="pl-k">SELECT</span> product_name, list_price, catalog_url 
                  <span class="pl-k">FROM</span> product_information
                  <span class="pl-k">WHERE</span> list_price <span class="pl-k">IS</span> <span class="pl-k">NOT</span> <span class="pl-c1">NULL</span>
                  <span class="pl-k">ORDER BY</span> list_price <span class="pl-k">DESC</span>) <span class="pl-k">LOOP</span>
     <span class="pl-k">IF</span> item.list_price <span class="pl-k">&gt;</span> p_minprice <span class="pl-k">THEN</span>
        v_color <span class="pl-k">:=</span> <span class="pl-s">'#CCCCFF'</span>;
     <span class="pl-k">ELSE</span>
        v_color <span class="pl-k">:=</span> <span class="pl-s">'#CCCCCC'</span>;
     <span class="pl-k">END IF</span>;
  %<span class="pl-k">&gt;</span>
  <span class="pl-k">&lt;</span>TR BGCOLOR<span class="pl-k">=</span><span class="pl-s">"&lt;%= v_color %&gt;"</span><span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>TD<span class="pl-k">&gt;&lt;</span>A HREF<span class="pl-k">=</span><span class="pl-s">"&lt;%= item.catalog_url %&gt;"</span><span class="pl-k">&gt;&lt;</span>%<span class="pl-k">=</span> item.product_name %<span class="pl-k">&gt;&lt;/</span>A<span class="pl-k">&gt;&lt;/</span>TD<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>TD<span class="pl-k">&gt;&lt;</span>BIG<span class="pl-k">&gt;&lt;</span>%<span class="pl-k">=</span> item.list_price %<span class="pl-k">&gt;&lt;/</span>BIG<span class="pl-k">&gt;&lt;/</span>TD<span class="pl-k">&gt;</span>
  <span class="pl-k">&lt;/</span>TR<span class="pl-k">&gt;</span>
  <span class="pl-k">&lt;</span>% <span class="pl-k">END LOOP</span>; %<span class="pl-k">&gt;</span></pre></div>

<p><a name="expression"></a></p>

<h3>
<a id="substituting-expression-values-in-a-teplsql-template" class="anchor" href="#substituting-expression-values-in-a-teplsql-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>Substituting expression values in a tePLSQL template</h3>

<p>An expression directive outputs a single PL/SQL expression, such as a string, arithmetic expression, function call, or combination of these things. The result is substituted as a string at that spot in the output that is produced by the template. The expression result must be a string value or be able to be cast to a string. For any types that cannot be implicitly cast, such as DATE, pass the value to the PL/SQL <code>TO_CHAR</code> function.</p>

<h4>
<a id="syntax-5" class="anchor" href="#syntax-5" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<p>The syntax of an expression directive is as follows, where the expression placeholder is replaced by the desired expression:</p>

<p><code>&lt;%= expression %&gt;</code></p>

<p>You need not end the PL/SQL expression with a semicolon.</p>

<h4>
<a id="example-5" class="anchor" href="#example-5" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<p>This example includes a directive to print the value of a variable in a row of a cursor:</p>

<p><code>&lt;%= emp_record.last_name %&gt;</code></p>

<p>The content within the <code>&lt;%= ... %&gt;</code> delimiters is processed by the <code>tePLSQL.P</code> procedure, which trims leading or trailing white space and requires that you enclose literal strings in single quotation marks.</p>

<p>You can use concatenation by using the twin pipe symbol (||) as in PL/SQL. This directive shows an example of concatenation:</p>

<p><code>&lt;%= 'The employee last name is ' || emp_record.last_name %&gt;</code></p>

<p><a name="escape"></a></p>

<h3>
<a id="escaping-reserved-words-in-a-teplsql-template" class="anchor" href="#escaping-reserved-words-in-a-teplsql-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>Escaping reserved words in a tePLSQL template</h3>

<p>tePLSQL has three reserved words: </p>

<ul>
<li><code>q'[]'</code></li>
<li><code>&lt;%</code></li>
<li><code>%&gt;</code></li>
<li><code>\\n</code></li>
</ul>

<p>tePLSQLP use <code>q'[]'</code> alternative quoting mechanism to print template text into buffer, and <code>&lt;% %&gt;</code> to define directives. </p>

<p>If you want to escape this reserved words you must use <code>\\</code>.</p>

<h4>
<a id="syntax-6" class="anchor" href="#syntax-6" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<p><code>\\reserved_word</code>  </p>

<h4>
<a id="example-6" class="anchor" href="#example-6" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<pre><code>Scaping reserved words:
- q\\'[]\\'
- &lt;\\%
- %\\&gt;
- \\\\n
</code></pre>

<p>Output:</p>

<pre><code>Scaping reserved words:
- q'[]'
- &lt;%
- %&gt;
- \\n
</code></pre>

<p><a name="lineBreak"></a></p>

<h3>
<a id="print-line-break-to-the-output" class="anchor" href="#print-line-break-to-the-output" aria-hidden="true"><span class="octicon octicon-link"></span></a>Print line break to the output</h3>

<p>The control of the white-space in a template is a problem that to some extent haunts every template engine in the business.</p>

<p>tePLSQL use white-space stripping. It automatically ignores (i.e. does not print to the output) superfluous white-spaces. The indentation white-space, and trailing white-space at the end of the line (includes the line break) will be ignored in lines that contains only tePLSQL tags (e.g. <code>&lt;%if ... %&gt;</code>, <code>&lt;%! ... %&gt;</code>), apart from the ignored white-space itself. </p>

<p>If you want to force insert a line break you can use <code>\\n</code></p>

<h4>
<a id="syntax-7" class="anchor" href="#syntax-7" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<p><code>\\n</code>  </p>

<h4>
<a id="example-7" class="anchor" href="#example-7" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<p>Without <code>\\n</code> </p>

<pre><code>&lt;% for i in 1 .. 10 loop %&gt;
Value: &lt;%=i%&gt;
&lt;%end loop;%&gt;
</code></pre>

<pre><code>Value: 1Value: 2Value: 3Value: 4Value: 5Value: 6Value: 7Value: 8Value: 9Value: 10
</code></pre>

<p>With <code>\\n</code></p>

<pre><code>&lt;% for i in 1 .. 10 loop %&gt;
Value: &lt;%=i%&gt;\\n
&lt;%end loop;%&gt;
</code></pre>

<pre><code>Value: 1
Value: 2
Value: 3
Value: 4
Value: 5
Value: 6
Value: 7
Value: 8
Value: 9
Value: 10
</code></pre>

<p><a name="noLineBreak"></a></p>

<h3>
<a id="remove-line-break-from-the-output" class="anchor" href="#remove-line-break-from-the-output" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remove line break from the output</h3>

<p>By the same way you can indicate in the template that a line break is not printed on the output. </p>

<h4>
<a id="syntax-8" class="anchor" href="#syntax-8" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<p><code>!\n</code>  </p>

<h4>
<a id="example-8" class="anchor" href="#example-8" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<p>Without <code>!\n</code> </p>

<pre><code>Values:
&lt;% for i in 1 .. 10 loop %&gt;
&lt;%=i%&gt;,
&lt;%end loop;%&gt;
</code></pre>

<pre><code>Values:
1,
2,
3,
4,
5,
6,
7,
8,
9,
10,
</code></pre>

<p>With <code>!\n</code></p>

<pre><code>Values:!\n
&lt;% for i in 1 .. 10 loop %&gt;
&lt;%=i%&gt;,!\n
&lt;%end loop;%&gt;
</code></pre>

<pre><code>Values:1,2,3,4,5,6,7,8,9,10,
</code></pre>

<p><a name="load"></a></p>

<h2>
<a id="loading-and-storing-teplsql-templates-into-the-database" class="anchor" href="#loading-and-storing-teplsql-templates-into-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading and storing tePLSQL templates into the Database</h2>

<p>You can store tePLSQL templates in the database in two ways: In the relational table <code>TE_TEMPLATES</code> or in any Oracle Object.</p>

<h3>
<a id="te_templates-table" class="anchor" href="#te_templates-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>TE_TEMPLATES table</h3>

<p><code>TE_TEMPLATES</code> table Is the default way of storing a tePLSQL templates. The table has a <code>TEMPLATE</code> column defined as CLOB where the template is loaded. </p>

<h4>
<a id="syntax-9" class="anchor" href="#syntax-9" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<pre><code>TABLE TE_TEMPLATES
 Name                                      Null?    Type                        
 ----------------------------------------- -------- ----------------------------
 NAME                                      NOT NULL VARCHAR2(300)               
 TEMPLATE                                           CLOB                        
 DESCRIPTION                                        VARCHAR2(300)               
 CREATED_BY                                NOT NULL VARCHAR2(100)               
 CREATED_DATE                              NOT NULL DATE                        
 MODIFIED_BY                               NOT NULL VARCHAR2(100)               
 MODIFIED_DATE                             NOT NULL DATE 
</code></pre>

<h4>
<a id="example-9" class="anchor" href="#example-9" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<p>Insert template named <em>adding</em> into <code>TE_TEMPLATES</code> table</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">INSERT</span> <span class="pl-k">INTO</span> te_templates (name
                        , template)
  <span class="pl-k">VALUES</span>   (<span class="pl-s">'ADDING'</span>
          , <span class="pl-s">'&lt;%@ template </span>
<span class="pl-s">    name=adding,</span>
<span class="pl-s">    version=0.1 %&gt;</span>
<span class="pl-s">&lt;%! x pls_integer := 1 + 1; %&gt;</span>
<span class="pl-s">Processing template ${template_name} with version ${template_version}</span>
<span class="pl-s">The variable x has the value: &lt;%= x %&gt;'</span>);

<span class="pl-c1">COMMIT</span>;</pre></div>

<p>Processing the template: </p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-c1">SET</span> SERVEROUTPUT <span class="pl-k">on</span>;
<span class="pl-k">BEGIN</span>
   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (teplsql.process (p_template_name <span class="pl-k">=&gt;</span> <span class="pl-s">'adding'</span>));
<span class="pl-k">END</span>;</pre></div>

<p>Output</p>

<pre><code>Processing template adding with version 0.1
The variable x has the value: 2
</code></pre>

<h3>
<a id="oracle-objects" class="anchor" href="#oracle-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Oracle Objects</h3>

<p>tePLSQL templates can be stored inside PL/SQL program unit spec or bodies.</p>

<p>In order to place a template into a program unit you have to create a non-compiled section in the latter with the aid of PL/SQL conditional compilation directives:</p>

<h4>
<a id="syntax-10" class="anchor" href="#syntax-10" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<pre><code>$if false $then
... template ...
$end
</code></pre>

<p>The syntax is case-sensitive but space-insensitive. Line breaks are not allowed. </p>

<h4>
<a id="example-10" class="anchor" href="#example-10" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">CREATE OR REPLACE</span> <span class="pl-k">PACKAGE</span> <span class="pl-en">test_tmpl</span>
<span class="pl-k">AS</span>
$<span class="pl-k">if</span> <span class="pl-c1">false</span> $<span class="pl-k">then</span>
<span class="pl-k">&lt;</span>%! x <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>; %<span class="pl-k">&gt;</span>
The variable x has the <span class="pl-c1">value</span>: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> x %<span class="pl-k">&gt;</span>
$<span class="pl-k">end</span>
<span class="pl-k">END</span> test_tmpl;</pre></div>

<p>Process the template:</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-c1">SET</span> SERVEROUTPUT <span class="pl-k">on</span>;
<span class="pl-k">BEGIN</span>
   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (teplsql.process (p_object_name <span class="pl-k">=&gt;</span> <span class="pl-s">'test_tmpl'</span>));
<span class="pl-k">END</span>;</pre></div>

<p>Outout:</p>

<pre><code>The variable x has the value: 2
</code></pre>

<h4>
<a id="anonymous--templates" class="anchor" href="#anonymous--templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Anonymous  templates</h4>

<p>An anonymous template must be the only template in its host object. The template resides in a non-compiled section and occupies it entirely. An example of an anonymous template placed in the <code>test_tmpl</code> package specification:</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">CREATE OR REPLACE</span> <span class="pl-k">PACKAGE</span> <span class="pl-en">test_tmpl</span>
<span class="pl-k">AS</span>
$<span class="pl-k">if</span> <span class="pl-c1">false</span> $<span class="pl-k">then</span>
<span class="pl-k">&lt;</span>%! x <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>; %<span class="pl-k">&gt;</span>
The variable x has the <span class="pl-c1">value</span>: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> x %<span class="pl-k">&gt;</span>
$<span class="pl-k">end</span>
<span class="pl-k">END</span> test_tmpl;</pre></div>

<p>tePLSQL seeks anonymous templates in objects greedily, so the following template contains two anonymous templates that tePLSQL merge and execute together.</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">create or replace</span> <span class="pl-k">package</span> <span class="pl-en">test_tmpl2</span> <span class="pl-k">as</span>
$<span class="pl-k">if</span> <span class="pl-c1">false</span> $<span class="pl-k">then</span>
<span class="pl-k">&lt;</span>%! x <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>;%<span class="pl-k">&gt;</span>
<span class="pl-c1">Value</span> X: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> x %<span class="pl-k">&gt;</span>
$<span class="pl-k">end</span>

$<span class="pl-k">if</span> <span class="pl-c1">false</span> $<span class="pl-k">then</span>
<span class="pl-k">&lt;</span>%! y <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">2</span> <span class="pl-k">+</span> <span class="pl-c1">3</span>; %<span class="pl-k">&gt;</span>
<span class="pl-c1">Value</span> Y: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> y %<span class="pl-k">&gt;</span>
$<span class="pl-k">end</span>
<span class="pl-k">end</span> test_tmpl2;
/</pre></div>

<p>tePLSQL interpret it as:</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">&lt;</span>%! x <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>;%<span class="pl-k">&gt;</span>
<span class="pl-c1">Value</span> X: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> x %<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>%! y <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">2</span> <span class="pl-k">+</span> <span class="pl-c1">3</span>; %<span class="pl-k">&gt;</span>
<span class="pl-c1">Value</span> Y: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> y %<span class="pl-k">&gt;</span></pre></div>

<p>Process the template:</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-c1">SET</span> SERVEROUTPUT <span class="pl-k">on</span>;
<span class="pl-k">BEGIN</span>
   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (teplsql.process (p_object_name <span class="pl-k">=&gt;</span> <span class="pl-s">'test_tmpl2'</span>));
<span class="pl-k">END</span>;</pre></div>

<p>Output:</p>

<pre><code>Value X: 2Value Y: 5 
</code></pre>

<h4>
<a id="named" class="anchor" href="#named" aria-hidden="true"><span class="octicon octicon-link"></span></a>Named</h4>

<p>In order to store several templates in a single object correctly you must
specify template characteristics, giving the name of the template.</p>

<p>Defining the template name</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">CREATE OR REPLACE</span> <span class="pl-k">PACKAGE</span> <span class="pl-en">test_tmpl</span>
<span class="pl-k">AS</span>

$<span class="pl-k">if</span> <span class="pl-c1">false</span> $<span class="pl-k">then</span>
<span class="pl-k">&lt;</span>%@ template 
    name<span class="pl-k">=</span>adding,
    version<span class="pl-k">=</span><span class="pl-c1">0.1</span> %<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>%! x <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">1</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>; %<span class="pl-k">&gt;</span>
Processing template ${template_name} with version ${template_version}
The variable x has the <span class="pl-c1">value</span>: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> x %<span class="pl-k">&gt;</span>
$<span class="pl-k">end</span>

$<span class="pl-k">if</span> <span class="pl-c1">false</span> $<span class="pl-k">then</span>
<span class="pl-k">&lt;</span>%@ template name<span class="pl-k">=</span>subtracting, version<span class="pl-k">=</span><span class="pl-c1">0.1</span>, revision<span class="pl-k">=</span><span class="pl-c1">3</span> %<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span>%! y <span class="pl-k">pls_integer</span> <span class="pl-k">:=</span> <span class="pl-c1">1</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>; %<span class="pl-k">&gt;</span>
Processing template ${template_name} with version ${template_version} <span class="pl-k">and</span> revision ${template_revision}
The variable y has the <span class="pl-c1">value</span>: <span class="pl-k">&lt;</span>%<span class="pl-k">=</span> y %<span class="pl-k">&gt;</span>
$<span class="pl-k">end</span>

<span class="pl-k">END</span> test_tmpl;</pre></div>

<p>Process the "subtracting" template:</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-c1">SET</span> SERVEROUTPUT <span class="pl-k">on</span>;
<span class="pl-k">BEGIN</span>
   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (teplsql.process (p_template_name <span class="pl-k">=&gt;</span> <span class="pl-s">'subtracting'</span>, p_object_name <span class="pl-k">=&gt;</span> <span class="pl-s">'test_tmpl'</span>));
<span class="pl-k">END</span>;</pre></div>

<p>Output:</p>

<pre><code>Processing template subtracting with version 0.1 and revision 3
The variable y has the value: 0
</code></pre>

<p><a name="examples"></a></p>

<h2>
<a id="examples-of-teplsql-templates" class="anchor" href="#examples-of-teplsql-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples of tePLSQL templates</h2>

<h3>
<a id="basic-example" class="anchor" href="#basic-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic Example</h3>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">DECLARE</span>
   p_template   <span class="pl-k">VARCHAR2</span> (<span class="pl-c1">32000</span>);
   p_vars       teplsql.t_assoc_array;
<span class="pl-k">BEGIN</span>
   p_template  <span class="pl-k">:=</span>
      <span class="pl-s">q'[&lt;%/* Using variables */%&gt;</span>
<span class="pl-s">       Hi ${FullName}!</span>
<span class="pl-s"></span>
<span class="pl-s">       &lt;%/* Using expressions */%&gt;</span>
<span class="pl-s">       Today &lt;%= TO_CHAR(SYSDATE, 'DD-MM-YYYY') %&gt; is a great day!</span>
<span class="pl-s"></span>
<span class="pl-s">       &lt;% --Using external variable in the query loop</span>
<span class="pl-s">          for c1 in (select username, user_id from all_users where username = upper('${username}')) loop %&gt;          </span>
<span class="pl-s">       Username: &lt;%= c1.username %&gt;, ID:&lt;%= c1.user_id %&gt;.</span>
<span class="pl-s">       &lt;% end loop; %&gt;       </span>
<span class="pl-s"></span>
<span class="pl-s">       &lt;%/* Escaping chars */%&gt;       </span>
<span class="pl-s">       This is the tePLSQL code block syntax &lt;\\% ... %\\&gt;</span>
<span class="pl-s"></span>
<span class="pl-s">       &lt;%/* Regards */%&gt;</span>
<span class="pl-s">       Bye &lt;%=UPPER('${username}')%&gt;.]'</span>;

   <span class="pl-c">--Key-value variables.</span>
   p_vars (<span class="pl-s">'FullName'</span>) <span class="pl-k">:=</span> <span class="pl-s">'Oscar Salvador Magallanes'</span>;
   p_vars (<span class="pl-s">'username'</span>) <span class="pl-k">:=</span> <span class="pl-s">'test'</span>;

   p_template  <span class="pl-k">:=</span> teplsql.render (p_vars, p_template);

   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (p_template);
<span class="pl-k">END</span>;</pre></div>

<p>Output:</p>

<pre><code>    Hi Oscar Salvador Magallanes!

    Today 08-09-2015 is a great day!

    Username: SYS

    This is the tePLSQL code block syntax &lt;% ... %&gt;

    Bye SYS.

    PL/SQL procedure successfully completed.
    Elapsed: 00:00:00.02
</code></pre>

<h3>
<a id="html-example" class="anchor" href="#html-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>HTML Example</h3>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">DECLARE</span>
   p_template   <span class="pl-k">CLOB</span>;
   p_vars       teplsql.t_assoc_array;
<span class="pl-k">BEGIN</span>
   p_template  <span class="pl-k">:=</span>
      <span class="pl-s">q'[&lt;!DOCTYPE html&gt;</span>
<span class="pl-s">    &lt;html&gt;</span>
<span class="pl-s">      &lt;head&gt;</span>
<span class="pl-s">        &lt;title&gt;${title}&lt;/title&gt;</span>
<span class="pl-s">      &lt;/head&gt;</span>
<span class="pl-s">      &lt;body&gt;</span>
<span class="pl-s">        &lt;h1&gt; Print Sequence numbers &lt;/h1&gt;</span>
<span class="pl-s">        &lt;br&gt;</span>
<span class="pl-s">        &lt;%for i in ${initValue} .. ${lastValue} loop %&gt;</span>
<span class="pl-s">        &lt;%= i %&gt;&lt;br&gt;</span>
<span class="pl-s">        &lt;% end loop;%&gt;</span>
<span class="pl-s">        &lt;h1&gt; Print the Odd numbers of sequence &lt;/h1&gt;</span>
<span class="pl-s">        &lt;br&gt;    </span>
<span class="pl-s">        &lt;% /*You can insert PLSQL comments as always*/ </span>
<span class="pl-s">        for i in ${initValue} .. ${lastValue}</span>
<span class="pl-s">        loop </span>
<span class="pl-s">            if mod(i,2) &lt;&gt; 0 </span>
<span class="pl-s">            then %&gt;</span>
<span class="pl-s">        &lt;%= i %&gt;&lt;br&gt;</span>
<span class="pl-s">        &lt;% end if; </span>
<span class="pl-s">        end loop; %&gt;</span>
<span class="pl-s">      &lt;/body&gt;</span>
<span class="pl-s">    &lt;/html&gt;]'</span>;

   <span class="pl-c">--Key-value variables.</span>
   p_vars (<span class="pl-s">'title'</span>) <span class="pl-k">:=</span> <span class="pl-s">'Number sequence'</span>;
   p_vars (<span class="pl-s">'initValue'</span>) <span class="pl-k">:=</span> <span class="pl-c1">5</span>;
   p_vars (<span class="pl-s">'lastValue'</span>) <span class="pl-k">:=</span> <span class="pl-c1">20</span>;

   p_template  <span class="pl-k">:=</span> teplsql.render (p_vars, p_template);

   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (p_template);
<span class="pl-k">END</span>;</pre></div>

<p>Output: </p>

<div class="highlight highlight-text-html-basic"><pre>&lt;!DOCTYPE html&gt;
    &lt;<span class="pl-ent">html</span>&gt;
      &lt;<span class="pl-ent">head</span>&gt;
        &lt;<span class="pl-ent">title</span>&gt;Number sequence&lt;/<span class="pl-ent">title</span>&gt;
      &lt;/<span class="pl-ent">head</span>&gt;
      &lt;<span class="pl-ent">body</span>&gt;
        &lt;<span class="pl-ent">h1</span>&gt; Print Sequence numbers &lt;/<span class="pl-ent">h1</span>&gt;
        &lt;<span class="pl-ent">br</span>&gt;
        5&lt;<span class="pl-ent">br</span>&gt;
        6&lt;<span class="pl-ent">br</span>&gt;
        7&lt;<span class="pl-ent">br</span>&gt;
        8&lt;<span class="pl-ent">br</span>&gt;
        9&lt;<span class="pl-ent">br</span>&gt;
        10&lt;<span class="pl-ent">br</span>&gt;
        11&lt;<span class="pl-ent">br</span>&gt;
        12&lt;<span class="pl-ent">br</span>&gt;
        13&lt;<span class="pl-ent">br</span>&gt;
        14&lt;<span class="pl-ent">br</span>&gt;
        15&lt;<span class="pl-ent">br</span>&gt;
        16&lt;<span class="pl-ent">br</span>&gt;
        17&lt;<span class="pl-ent">br</span>&gt;
        18&lt;<span class="pl-ent">br</span>&gt;
        19&lt;<span class="pl-ent">br</span>&gt;
        20&lt;<span class="pl-ent">br</span>&gt;
        &lt;<span class="pl-ent">h1</span>&gt; Print the Odd numbers of sequence &lt;/<span class="pl-ent">h1</span>&gt;
        &lt;<span class="pl-ent">br</span>&gt;    
        5&lt;<span class="pl-ent">br</span>&gt;
        7&lt;<span class="pl-ent">br</span>&gt;
        9&lt;<span class="pl-ent">br</span>&gt;
        11&lt;<span class="pl-ent">br</span>&gt;
        13&lt;<span class="pl-ent">br</span>&gt;
        15&lt;<span class="pl-ent">br</span>&gt;
        17&lt;<span class="pl-ent">br</span>&gt;
        19&lt;<span class="pl-ent">br</span>&gt;
      &lt;/<span class="pl-ent">body</span>&gt;
    &lt;/<span class="pl-ent">html</span>&gt;
    PL/SQL procedure successfully completed.
    Elapsed: 00:00:00.02</pre></div>

<h3>
<a id="excel-example" class="anchor" href="#excel-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Excel example</h3>

<p>Generating formatted Excel file. Save the result as .xml file and open it with MS Excel.</p>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-c1">set</span> timing <span class="pl-k">on</span>;
<span class="pl-c1">set</span> serveroutput <span class="pl-k">on</span>;

<span class="pl-k">DECLARE</span>
   p_template   <span class="pl-k">CLOB</span>;
   p_vars       teplsql.t_assoc_array;
<span class="pl-k">BEGIN</span>
   p_template  <span class="pl-k">:=</span>
      <span class="pl-s">q'[&lt;?xml version="1.0"?&gt;</span>
<span class="pl-s">&lt;?mso-application progid="Excel.Sheet"?&gt;</span>
<span class="pl-s">&lt;Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"</span>
<span class="pl-s"> ...</span>
<span class="pl-s">   &lt;% for i in 1 .. 26 loop%&gt;</span>
<span class="pl-s">   &lt;Row ss:AutoFitHeight="0"&gt;</span>
<span class="pl-s">    &lt;Cell ss:Index="2" ss:StyleID="s65"&gt;&lt;Data ss:Type="Number"&gt;&lt;%=i%&gt;&lt;/Data&gt;&lt;/Cell&gt;</span>
<span class="pl-s">    &lt;Cell ss:StyleID="s66"&gt;&lt;Data ss:Type="String"&gt;&lt;%=CHR (i + 64)%&gt;&lt;/Data&gt;&lt;/Cell&gt;</span>
<span class="pl-s">    &lt;Cell ss:StyleID="s66"&gt;&lt;Data ss:Type="Number"&gt;&lt;%=i%&gt;&lt;/Data&gt;&lt;/Cell&gt;</span>
<span class="pl-s">    &lt;Cell ss:StyleID="s66"&gt;&lt;Data ss:Type="Number"&gt;&lt;%=i+10%&gt;&lt;/Data&gt;&lt;/Cell&gt;</span>
<span class="pl-s">    &lt;Cell ss:StyleID="s67"&gt;&lt;Data ss:Type="Number"&gt;&lt;%=i+20%&gt;&lt;/Data&gt;&lt;/Cell&gt;</span>
<span class="pl-s">   &lt;/Row&gt; </span>
<span class="pl-s">   &lt;% end loop; %&gt;</span>
<span class="pl-s"> ...</span>
<span class="pl-s">&lt;/Workbook&gt;]'</span>;

   p_template  <span class="pl-k">:=</span> teplsql.render (p_vars, p_template);

   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (p_template);
<span class="pl-k">END</span>;</pre></div>

<p>Output:</p>

<p><img src="ExcelScreenShot.png" alt="Excel screenshot"></p>

<h4>
<a id="declaration-and-instructions" class="anchor" href="#declaration-and-instructions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Declaration and instructions</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">DECLARE</span>
   p_template   <span class="pl-k">CLOB</span>;
   p_vars       teplsql.t_assoc_array;
<span class="pl-k">BEGIN</span>
   p_template  <span class="pl-k">:=</span> 
   <span class="pl-s">q'[&lt;%! lang_name VARCHAR2(10) := 'PL/SQL';</span>
<span class="pl-s">       l_random_number pls_integer := ROUND(DBMS_RANDOM.VALUE (1, 9));</span>
<span class="pl-s">      %&gt; </span>
<span class="pl-s">        The 'sequence' is used in scripting language: &lt;%=lang_name %&gt;.            </span>
<span class="pl-s">        The result of the operation ${someInValue} * &lt;%= l_random_number %&gt; is &lt;%= ${someInValue} * l_random_number %&gt;</span>
<span class="pl-s">    ]'</span>;

   <span class="pl-c">--Key-value variables.   </span>
   p_vars (<span class="pl-s">'someInValue'</span>) <span class="pl-k">:=</span> <span class="pl-c1">5</span>;   

   p_template  <span class="pl-k">:=</span> teplsql.render (p_vars, p_template);

   <span class="pl-c1"><span class="pl-c1">DBMS_OUTPUT.</span><span class="pl-c1">put_line</span></span> (p_template);
<span class="pl-k">END</span>;</pre></div>

<p>Output:</p>

<pre><code>    The 'sequence' is used in scripting language: PL/SQL.
    The result of the operation 5 * 7 is 35
</code></pre>

<p><a name="debug"></a></p>

<h2>
<a id="debugging-teplsql-templates" class="anchor" href="#debugging-teplsql-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debugging tePLSQL templates</h2>

<p>As you begin experimenting with tePLSQL templates, and as you adapt your first simple templates into more elaborate ones, keep these guidelines in mind when you encounter problems. </p>

<h3>
<a id="find-where-the-template-fails" class="anchor" href="#find-where-the-template-fails" aria-hidden="true"><span class="octicon octicon-link"></span></a>Find where the template fails</h3>

<p>tePLSQL interprets the template and converts it into executable PL/SQL code. When error is occurred you will see the description in the <code>DBMS_OUTPUT</code>:</p>

<p>Rendering this template: </p>

<pre><code>Testing Error. 
&lt;%/* Raising error "divisor is equal to zero" */%&gt;
Raising an error &lt;%= 10/0 %&gt;.
</code></pre>

<p>You will get this error:</p>

<pre><code>Testing Error. 
Raising an error ### tePLSQL Render Error ###
ORA-01476: divisor is equal to zero ORA-06512: at line 2
ORA-06512: at "USER.TEPLSQL", line 666

### Processed template ###
DECLARE  BEGIN tePLSQL.p(q'[Testing Error. 
]'); /* Raising error "divisor is equal to zero" */ tePLSQL.p(q'[Raising an error ]');tePLSQL.p( 10/0 );tePLSQL.p(q'[. ]'); END;
</code></pre>

<p><code>### Processed template ###</code> is the template converted into executable PL/SQL.</p>

<p>You can see <code>ORA-01476: divisor is equal to zero ORA-06512: at line 2</code> means that in the second line of the <code>### Processed template ###</code> code you have the error. </p>

<p>The exception message will be append into the tePLSQL buffer. This helps you to find where the exception is occurred. tePLSQL trunc the buffer at maximum 500 characters to prevent the exception message is truncated in long templates.</p>

<h4>
<a id="syntax-error" class="anchor" href="#syntax-error" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax error</h4>

<p>Rendering this template:</p>

<pre><code>Testing syntax Error. 
&lt;%/* Raising syntax error */%&gt;
Raising an error &lt;%= 10/1; %&gt;.
</code></pre>

<p>You will get this error:</p>

<pre><code>### tePLSQL Render Error ###
ORA-06550: line 2, column 82:
PLS-00103: Encountered the symbol ";" when expecting one of the following:

   ) , * &amp; = - + &lt; / &gt; at in is mod remainder not rem =&gt;
   &lt;an exponent (**)&gt; &lt;&gt; or != or ~= &gt;= &lt;= &lt;&gt; and or like like2
   like4 likec as between from using || member submultiset
The symbol ";" was ignored. ORA-06512: at "DBAX.TEPLSQL", line 666

### Processed template ###
DECLARE  BEGIN tePLSQL.p(q'[Testing syntax Error. 
]'); /* Raising syntax error */ tePLSQL.p(q'[Raising an error ]');tePLSQL.p( 10/1; );tePLSQL.p(q'[. ]'); END;
</code></pre>

<p>You will see at line 2 column 82, this instruction <code>tePLSQL.p( 10/1; )</code> that is not valid in PL/SQL. </p>

<p><a name="apiReference"></a></p>

<h2>
<a id="teplsql-api-reference" class="anchor" href="#teplsql-api-reference" aria-hidden="true"><span class="octicon octicon-link"></span></a>tePLSQL API reference</h2>

<h3>
<a id="render" class="anchor" href="#render" aria-hidden="true"><span class="octicon octicon-link"></span></a>RENDER</h3>

<p>Renders the template received as parameter. </p>

<h4>
<a id="syntax-11" class="anchor" href="#syntax-11" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">FUNCTION</span> <span class="pl-en">render</span> (p_vars <span class="pl-k">IN</span> t_assoc_array <span class="pl-k">DEFAULT</span> null_assoc_array,p_template <span class="pl-k">IN</span> <span class="pl-k">CLOB</span>)
  <span class="pl-k">RETURN</span> <span class="pl-k">CLOB</span>;</pre></div>

<h4>
<a id="parameters" class="anchor" href="#parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h4>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>p_vars</td>
<td>The template's arguments.</td>
</tr>
<tr>
<td>p_template</td>
<td>The template's body.</td>
</tr>
<tr>
<td>return CLOB</td>
<td>The processed template.</td>
</tr>
</tbody>
</table>

<h3>
<a id="process" class="anchor" href="#process" aria-hidden="true"><span class="octicon octicon-link"></span></a>PROCESS</h3>

<p>Rceives the name of the object, usually a package, which contains an embedded template. The template is extracted and is rendered with <code>render</code> function </p>

<h4>
<a id="syntax-12" class="anchor" href="#syntax-12" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">FUNCTION</span> <span class="pl-en">process</span> (p_vars            <span class="pl-k">IN</span> t_assoc_array <span class="pl-k">DEFAULT</span> null_assoc_array
                , p_template_name   <span class="pl-k">IN</span> <span class="pl-k">VARCHAR2</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">NULL</span>
                , p_object_name     <span class="pl-k">IN</span> <span class="pl-k">VARCHAR2</span> <span class="pl-k">DEFAULT</span> <span class="pl-s">'TE_TEMPLATES'</span>                                      
                , p_object_type     <span class="pl-k">IN</span> <span class="pl-k">VARCHAR2</span> <span class="pl-k">DEFAULT</span> <span class="pl-s">'PACKAGE'</span>
                , p_schema          <span class="pl-k">IN</span> <span class="pl-k">VARCHAR2</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">NULL</span> )</pre></div>

<h4>
<a id="parameters-1" class="anchor" href="#parameters-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h4>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>p_vars</td>
<td>The template's arguments.</td>
</tr>
<tr>
<td>p_template_name</td>
<td>The name of the template.</td>
</tr>
<tr>
<td>p_object_name</td>
<td>The name of the object (usually the name of the package).</td>
</tr>
<tr>
<td>p_object_type</td>
<td>The type of the object (PACKAGE, PROCEDURE, FUNCTION...).</td>
</tr>
<tr>
<td>p_schema</td>
<td>The object's schema name.</td>
</tr>
<tr>
<td>return CLOB</td>
<td>The processed template.</td>
</tr>
</tbody>
</table>

<h3>
<a id="print" class="anchor" href="#print" aria-hidden="true"><span class="octicon octicon-link"></span></a>PRINT</h3>

<p>Prints received data into the buffer</p>

<h4>
<a id="syntax-13" class="anchor" href="#syntax-13" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">PROCEDURE</span> <span class="pl-en">PRINT</span> (p_data <span class="pl-k">IN</span> <span class="pl-k">CLOB</span>);

<span class="pl-k">PROCEDURE</span> <span class="pl-en">p</span> (p_data <span class="pl-k">IN</span> <span class="pl-k">CLOB</span>);

<span class="pl-k">PROCEDURE</span> <span class="pl-en">PRINT</span> (p_data <span class="pl-k">IN</span> <span class="pl-k">VARCHAR2</span>);

<span class="pl-k">PROCEDURE</span> <span class="pl-en">p</span> (p_data <span class="pl-k">IN</span> <span class="pl-k">VARCHAR2</span>);

<span class="pl-k">PROCEDURE</span> <span class="pl-en">PRINT</span> (p_data <span class="pl-k">IN</span> <span class="pl-k">NUMBER</span>);

<span class="pl-k">PROCEDURE</span> <span class="pl-en">p</span> (p_data <span class="pl-k">IN</span> <span class="pl-k">NUMBER</span>);</pre></div>

<h4>
<a id="parameters-2" class="anchor" href="#parameters-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h4>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>p_data</td>
<td>The data to print into buffer</td>
</tr>
</tbody>
</table>

<h3>
<a id="output_clob" class="anchor" href="#output_clob" aria-hidden="true"><span class="octicon octicon-link"></span></a>OUTPUT_CLOB</h3>

<p>Output CLOB data to the DBMS_OUTPUT.PUT_LINE</p>

<h4>
<a id="syntax-14" class="anchor" href="#syntax-14" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syntax</h4>

<div class="highlight highlight-source-plsql-oracle"><pre><span class="pl-k">PROCEDURE</span> <span class="pl-en">output_clob</span>(p_clob <span class="pl-k">in</span> <span class="pl-k">CLOB</span>);</pre></div>

<h4>
<a id="parameters-3" class="anchor" href="#parameters-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parameters</h4>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>p_clob</td>
<td>The CLOB to print to the DBMS_OUTPUT</td>
</tr>
</tbody>
</table>

<p><a name="contributing"></a></p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>If you have ideas, get in touch directly.</p>

<p>Please inser at the bottom of your commit message the following line using your name and e-mail address .</p>

<pre><code>Signed-off-by: Your Name &lt;you@example.org&gt;
</code></pre>

<p>This can be automatically added to pull requests by committing with:</p>

<pre><code>git commit --signoff
</code></pre>

<p><a name="license"></a></p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>Copyright 2015 Oscar Salvador Magallanes </p>

<p>tePLSQL is under MIT license. </p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/osalvador/tePLSQL">tePLSQL</a> is maintained by <a href="https://github.com/osalvador">osalvador</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
